/*! dds-app 09-12-2013 */
"use strict";String.prototype.format=function(){for(var formatted=this,i=0;i<arguments.length;i++){var regexp=new RegExp("\\{"+i+"\\}","gi");formatted=formatted.replace(regexp,arguments[i])}return formatted},angular.module("LocalStorageModule").value("prefix","dds_scholen"),angular.module("ddsApp.controllers",[]),angular.module("ddsApp.services",[]),angular.module("ddsApp.directives",[]),angular.module("ddsApp.filters",[]);var app=angular.module("ddsApp",["ngRoute","ngResource","ddsApp.controllers","ddsApp.services","ddsApp.directives","ddsApp.filters","LocalStorageModule"]).config(["$routeProvider","$locationProvider","$httpProvider",function($routeProvider,$locationProvider,$httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"],$routeProvider.when("/",{templateUrl:"views/main.html",controller:"ddsApp.controllers.MainCtrl",resolve:{weather:appCtrl.loadLocalWeather}}),$routeProvider.when("/app",{templateUrl:"views/app.html",controller:"AppCtrl",resolve:{appInitialized:appCtrl.loadConfiguration}}),$routeProvider.otherwise({redirectTo:"/"})}]).run(["$rootScope","$timeout","$location","ddsApp.services.WeatherSrvc",function($rootScope,$timeout,$location){$rootScope.appInitialized=!1,$rootScope.$on("$routeChangeStart",function(){$rootScope.appInitialized?$rootScope.appInitialized&&"/app"===$location.path()&&$location.path("/"):$location.path("/app")})}]),appCtrl=app.controller("AppCtrl",["$scope","$location","appInitialized",function($scope,$location,appInitialized){appInitialized&&$location.path("/")}]);appCtrl.loadConfiguration=["$rootScope","$q","$timeout","ddsApp.services.WeatherSrvc",function($rootScope,$q,$timeout,WeatherSrvc){var deferred=$q.defer();return WeatherSrvc.loadConfiguration().then(function(data){$timeout(function(){$rootScope.appInitialized=!0,deferred.resolve(data)},2e3)},function(error){deferred.reject(error)}),deferred.promise}],appCtrl.loadLocalWeather=["$rootScope","$q","ddsApp.services.WeatherSrvc",function($rootScope,$q,WeatherSrvc){var deferred=$q.defer();return WeatherSrvc.getGEOLocation().then(function(data){WeatherSrvc.loadWeather(data.coords.latitude,data.coords.longitude,"metric").then(function(data){deferred.resolve(data)},function(error){deferred.reject(error)})},function(error){deferred.reject(error)}),deferred.promise}],function(){var filters=angular.module("ddsApp.filters");filters.filter("WeatherValueFltr",function(){return function(value,trailingdecimals){var v=parseFloat(value);return v.toFixed(trailingdecimals)}}),filters.filter("WeatherDateFilter",function(){return function(value,dateFormat){var date=new Date(1e3*value);return $.format.date(date,dateFormat)}})}(),function(){var controllers=angular.module("ddsApp.controllers");controllers.controller("ddsApp.controllers.MainCtrl",["$scope","weather",function($scope,weather){$scope.weather=weather,$scope.getClimaCon=function(iconId){switch(iconId){case 801:return" climacon cloud sun";case 804:return" climacon cloud";default:return" climacon sun"}}}])}(),function(){var services=angular.module("ddsApp.services");services.factory("ddsApp.services.WeatherSrvc",["$rootScope","$http","$q","localStorageService",function($rootScope,$http,$q){var _geoPosition,URLWEATHER="http://api.openweathermap.org/data/2.5/weather?lat={0}&lon={1}&mode=json&units={2}&callback=JSON_CALLBACK",MSGWEATHERLOADERROR="Could not load the Weather call",MSGGEOLOCATIONNOTSUPPORTED="GEO Location not supported";return{loadConfiguration:function(){var deferred=$q.defer();return deferred.resolve(!0),deferred.promise},loadWeather:function(lat,long,units){var deferred=$q.defer(),url=URLWEATHER.format(lat,long,units);return $http.jsonp(url).success(function(data){deferred.resolve(data)}).error(function(){deferred.reject(MSGWEATHERLOADERROR)}),deferred.promise},getGEOLocation:function(){var deferred=$q.defer();return Modernizr.geolocation?navigator.geolocation.getCurrentPosition(function(position){_geoPosition=position,deferred.resolve(position)},function(){deferred.reject(MSGGEOLOCATIONNOTSUPPORTED)},{timeout:1e4,enableHighAccuracy:!0}):deferred.reject(MSGGEOLOCATIONNOTSUPPORTED),deferred.promise}}}])}();